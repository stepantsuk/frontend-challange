# PWA (Progressive Web App)
___

**PWA** — это веб-приложение, поведение и функционал которого приближен к нативному.

**Минимальные требования** для работы PWA — это:
- Валидное и защищенное HTTPS-подключение (у домена должен быть установлен SSL-сертификат).
- Успешно установленный файл Service Worker`а.
- Правильно установленный и валидный JSON-файл манифеста.
___

## 3 кита PWA
1. Service Worker (главный мозг).
   Это JavaScript-файл, который работает в фоновом потоке, отдельно от страницы.
   «Сердце» PWA — Service Worker. Это проксирующий слой между фронтэндом и бэкэндом, находящийся в браузере. Все запросы браузера идут через него.
```js
// sw.js - простейший service worker
self.addEventListener('install', (event) => {
  console.log('SW установлен');
});

self.addEventListener('fetch', (event) => {
  console.log('Перехват запроса:', event.request.url);
});
```
2. Web App Manifest (визитная карточка).
   JSON-файл, декларативно определяющий для браузера название приложения, иконку, как будет выглядеть PWA (fullscreen, standalone и другие варианты отображения) и некоторые другие параметры. Позволяет «установить» PWA как отдельное приложение на домашний экран смартфона.

```json
{
  "name": "Мое PWA",
  "short_name": "PWA",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#4285f4",
  "icons": [
    {
      "src": "/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    }
  ]
}
```
Подключаем в HTML:
```html
<link rel="manifest" href="/manifest.json">
```
3. HTTPS. Без HTTPS service worker не заработает (кроме localhost).
___
## Отображение PWA
PWA работают на базе WebView, который предоставляют браузеры. Браузер, который будет открывать PWA после установки приложения, определяется операционной системой iOS или Android. Для Android используется Google Chrome, а для iOS — Safari. Очень упрощенно можно сказать, что PWA открывается во вкладке браузера, но без интерфейса самого браузера. Однако мы можем отображать интерфейс браузера, если нам это необходимо.
**Варианты отображения:**
- fullscreen
- standalone
- minimal-ui
- browser
___
## Фреймворки и библиотеки
Для PWA необходимо только два файла — Service Worker и Web App manifest, — поэтому для разработки подойдут все актуальные реактивные фреймворки. Для каждого из них есть плагин, который добавляет предустановленный файл манифеста, предустановленный файл service worker’a и дополнительную функциональность.

Также есть фреймворки конкретно для работы с PWA:
- React PWA Library
- Angular PWA Framework
- Vue PWA Framework
- Ionic PWA Framework
- Svelte PWA Framework
___
## Отличительные качества PWA
- Ограниченный доступ к аппаратной части
- Установка в обход магазинов приложений
- Фоновая установка обновлений
- Меньший размер приложения
- Меньшие затраты на разработчиков
- В общем, PWA имеет свои отличительные особенности и недостатки.

В связи с ограничениями аппаратной части, PWA не может полностью заменить нативные приложения, но **четыре ключевые функции** PWA-приложений закрывают потребности 90% мобильных пользователей:
- Отправка Push-уведомлений, чтобы вернуть пользователей.
- Установка иконки на домашний экран, чтобы дать пользователям быстрый доступ к приложению.
- Доступ к некоторым нативным аппаратным функциям, например, камеры, микрофона.
- Возможность работы офлайн.

Мы **рекомендуем** разрабатывать PWA-приложения когда нужно:
- Повысить удовлетворенность и вовлеченность клиентов/пользователей, например, дать пользователям быстрый доступ к повторным заказам.
- Протестировать гипотезу с минимальными финансовыми вложениями: прежде чем вкладывать в разработку нативного приложения, можно протестировать на PWA.
- Сделать кроссплатформенную совместимость в сжатые сроки
- Предложить аудитории новый канал взаимодействия с компанией.
___
## Как интегрировать PWA в сайт
Инструкция:
1. Добавить файлы manifest и serviceworker
   https://pwa-workshop.js.org/1-manifest/
   https://app-manifest.firebaseapp.com/
   https://developer.mozilla.org/en-US/docs/Web/Manifest
   https://pwa-workshop.js.org/2-service-worker/
   https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API/Using_Service_Workers
2. Подключить и настроить библиотеки workbox
   https://developer.chrome.com/docs/workbox/the-ways-of-workbox?hl=ru
   https://developer.chrome.com/docs/workbox/framework-integrations?hl=ru
3. Добавить кнопки на сайте для установки приложения
4. Запросить разрешения на отправку push-уведомлений
   Последующие пункты необязательны, но могут пригодиться для дополнительных этапов интеграции.
5. Настроить различные стратегии кэширования для статичных файлов
6. Настроить показ уведомлений при обновлении кеша
7. Запись и чтение данных в IndexedDB
___
**Стратегии кеширования PWA — кратко и по делу**
1. Cache Only
   Только кеш. Если ресурса нет — ошибка.
   ✅ Статика, иконки, шрифты
   ❌ Динамические данные

2. Network Only
   Только сеть.
   ✅ API-запросы, которые всегда должны быть свежими
   ❌ Нет офлайн-доступа
3. Cache First, Network Fallback
   Сначала кеш → если нет → сеть → сохраняем в кеш.
   ✅ Быстро, офлайн-доступ, подходит для контента, который редко меняется
   ❌ Устаревшие данные до следующего визита
4. Network First, Cache Fallback
   Сначала сеть → если нет сети → кеш.
   ✅ Всегда свежие данные, есть запасной план
   ❌ Медленнее при плохом соединении
5. Stale-While-Revalidate
   Отдаём кеш, параллельно обновляем в фоне.
   ✅ Быстро и всегда обновляется к следующему разу
   ❌ Пользователь может увидеть старую версию один раз

| Тип контента	| Стратегия |
| Статика (CSS, JS, img) | Cache First |
| HTML-страницы	| Network First / Stale-While-Revalidate |
| API (данные)	| Network First (или Cache First с TTL) |
| Офлайн-заглушки	| Cache Only |

## Workbox
Это стандарт для PWA. Позволяет не изобретать велосипед и сосредоточиться на логике приложения.

Workbox — это библиотека от Google, которая оборачивает сложности Service Worker API в простые методы. Позволяет писать SW в декларативном стиле, без ручного управления кешами и событиями fetch.

**Что внутри ?**
Precaching — кеширование статики при установке
Routing + Strategies — маршрутизация запросов со стратегиями:
Expiration — контроль размера кеша и времени жизни
Background Sync — отложенные запросы при появлении сети.
Push-уведомления, Analytics, Navigation Preload и др.

Почему стоит использовать
✅ Меньше кода — 10 строк вместо 50
✅ Правильные дефолты — кеш не распухает, обновления корректные
✅ DevTools — расширение Workbox для Chrome (просмотр кешей, маршрутов)
✅ Актуальность — под капотом лучшие практики, поддержка Google

**Базовый SW с Workbox**:
```js
import { precacheAndRoute } from 'workbox-precaching';
import { registerRoute } from 'workbox-routing';
import { StaleWhileRevalidate, CacheFirst } from 'workbox-strategies';

precacheAndRoute(self.__WB_MANIFEST);

registerRoute(
  /\.(?:png|jpg|jpeg|svg|gif)$/,
  new CacheFirst({ cacheName: 'images' })
);

registerRoute(
  /\.(?:js|css)$/,
  new StaleWhileRevalidate({ cacheName: 'static' })
);
```
